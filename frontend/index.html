<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CitySort AI MVP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script>
      (() => {
        const root = document.documentElement;
        const THEME_KEY = "citysort_theme";
        const saved = localStorage.getItem(THEME_KEY);
        const applyTimeTheme = () => {
          if (localStorage.getItem(THEME_KEY)) return;
          const hour = new Date().getHours();
          const isDark = hour >= 19 || hour < 7;
          root.setAttribute("data-theme", isDark ? "dark" : "light");
        };
        if (saved) { root.setAttribute("data-theme", saved); } else { applyTimeTheme(); }
        window.setInterval(applyTimeTheme, 60000);
        window._toggleTheme = () => {
          const current = root.getAttribute("data-theme") || "light";
          const next = current === "dark" ? "light" : "dark";
          root.setAttribute("data-theme", next);
          localStorage.setItem(THEME_KEY, next);
        };
      })();
    </script>
    <style>
      /* Critical fallback so shell layout remains usable if stale cached CSS is served. */
      :root {
        --bg: #f3f4f6;
        --surface: #ffffff;
        --surface-muted: #f6f7f9;
        --line: #d1d5db;
        --ink: #111827;
        --ink-soft: #4b5563;
        --accent: #0a66d6;
        --accent-soft: #e7f0fa;
        --primary-btn-bg: #111827;
        --primary-btn-text: #f9fafb;
      }

      html[data-theme="dark"] {
        --bg: #0b0f14;
        --surface: #161b22;
        --surface-muted: #121820;
        --line: #2e3742;
        --ink: #f1f5f9;
        --ink-soft: #9ca3af;
        --accent: #60a5fa;
        --accent-soft: #15273c;
        --primary-btn-bg: #f1f5f9;
        --primary-btn-text: #0f172a;
      }

      html,
      body {
        margin: 0;
        min-height: 100%;
        font-size: 18px;
        background: var(--bg);
        color: var(--ink);
        font-family: "IBM Plex Sans", "Segoe UI", -apple-system, sans-serif;
      }

      a {
        color: inherit;
        text-decoration: none;
      }

      .app-shell {
        min-height: 100vh;
        display: grid;
        grid-template-columns: 304px 1fr;
      }

      .shell-sidebar {
        border-right: 1px solid var(--line);
        background: var(--surface-muted);
        padding: 1rem;
      }

      .sidebar-link {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        color: var(--ink-soft);
        padding: 0.5rem 0.62rem;
        border-radius: 0.55rem;
      }

      .sidebar-service {
        border: 1px solid var(--line);
        border-radius: 0.75rem;
        background: var(--surface);
        padding: 0.68rem;
      }

      .sidebar-account {
        display: grid;
        grid-template-columns: auto 1fr;
        gap: 0.5rem;
        align-items: center;
        border: 1px solid var(--line);
        border-radius: 0.75rem;
        background: var(--surface);
        padding: 0.65rem;
      }

      .account-avatar {
        width: 2rem;
        height: 2rem;
        border-radius: 999px;
        display: grid;
        place-items: center;
        border: 1px solid var(--line);
        background: var(--accent-soft);
        color: var(--accent);
        font-weight: 700;
      }

      .sidebar-link.active {
        background: var(--accent-soft);
        color: var(--accent);
      }

      .shell-main {
        padding: 1rem 1.15rem;
      }

      .app-toolbar {
        display: flex;
        gap: 0.65rem;
        justify-content: space-between;
        margin-bottom: 0.8rem;
      }

      .toolbar-search {
        flex: 1;
      }

      .toolbar-actions {
        display: flex;
        gap: 0.5rem;
      }

      .platform-status {
        margin: 0 0 0.8rem;
        border: 1px solid var(--line);
        border-radius: 0.56rem;
        padding: 0.5rem 0.62rem;
        background: var(--surface);
      }

      .shell-topbar {
        border: 1px solid var(--line);
        border-radius: 0.75rem;
        background: var(--surface);
        padding: 1rem 1.15rem;
      }

      .topbar-meta {
        margin-top: 0.62rem;
        display: flex;
        flex-wrap: wrap;
        gap: 0.4rem;
      }

      .meta-chip {
        display: inline-flex;
        align-items: center;
        border-radius: 0.4rem;
        border: 1px solid var(--line);
        background: var(--surface-muted);
        color: var(--ink-soft);
        font-size: 0.78rem;
        padding: 0.24rem 0.5rem;
      }

      .meta-chip.accent {
        border-color: var(--accent);
        background: var(--accent-soft);
        color: var(--accent);
      }

      .shell-tabs {
        margin-top: 0.72rem;
        display: flex;
        gap: 0.16rem;
        border-bottom: 1px solid var(--line);
        overflow-x: auto;
      }

      .topbar-actions {
        display: flex;
        gap: 0.48rem;
        justify-content: flex-end;
      }

      .tab {
        color: var(--ink-soft);
        padding: 0.58rem 0.78rem;
        border-bottom: 2px solid transparent;
        white-space: nowrap;
      }

      .tab.active {
        color: var(--accent);
        border-color: var(--accent);
      }

      .layout {
        margin-top: 0.88rem;
        display: grid;
        grid-template-columns: repeat(12, minmax(0, 1fr));
        gap: 0.9rem;
      }

      .panel {
        border-radius: 0.75rem;
        border: 1px solid var(--line);
        background: var(--surface);
        padding: 1rem;
      }

      .link-icon {
        width: 0.75rem;
        height: 0.75rem;
        border-radius: 0.2rem;
        border: 1px solid var(--line);
        background: var(--surface);
        flex: 0 0 auto;
      }

      :where(
        .sidebar-service,
        .sidebar-account,
        .account-avatar,
        .platform-status,
        .shell-topbar,
        .meta-chip,
        .panel,
        .link-icon,
        .sidebar-link,
        input,
        select,
        textarea,
        button
      ) {
        border-radius: 0 !important;
      }

      .app-shell * {
        border-radius: 0 !important;
      }

      .panel.is-page-hidden {
        display: none;
      }

      .upload-panel {
        grid-column: span 4;
      }

      .metrics-panel {
        grid-column: span 8;
      }

      .db-import-panel,
      .review-panel,
      .rules-panel {
        grid-column: span 12;
      }

      .queues-panel,
      .worklist-panel {
        grid-column: span 6;
      }

      @media (max-width: 1320px) {
        .upload-panel,
        .metrics-panel,
        .queues-panel,
        .worklist-panel {
          grid-column: span 12;
        }
      }

      @media (max-width: 1040px) {
        .app-shell {
          grid-template-columns: 1fr;
        }

        html,
        body {
          font-size: 16px;
        }

        .app-toolbar {
          flex-direction: column;
        }
      }
    </style>
    <link rel="stylesheet" href="/static/styles.v2.css" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="shell-sidebar">
        <div class="sidebar-brand">
          <div class="brand-mark" aria-hidden="true">CS</div>
          <div>
            <p class="sidebar-kicker">CitySort</p>
            <strong>Operations Suite</strong>
          </div>
        </div>

        <div class="sidebar-account">
          <div class="account-avatar" aria-hidden="true">P</div>
          <div class="account-meta">
            <strong>Personal</strong>
            <span>citysort workspace</span>
          </div>
        </div>

        <div class="sidebar-service">
          <span class="sidebar-service-label">Service</span>
          <strong>citysort</strong>
          <span class="sidebar-service-meta">Python 3 Â· Managed</span>
          <a href="/?page=overview" class="sidebar-home">Open overview</a>
        </div>

        <div class="sidebar-group">
          <p class="sidebar-label">Monitor</p>
          <a href="/?page=overview" class="sidebar-link active" data-page="overview"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="1.5" y="1.5" width="5" height="5" rx="1"/><rect x="9.5" y="1.5" width="5" height="5" rx="1"/><rect x="1.5" y="9.5" width="5" height="5" rx="1"/><rect x="9.5" y="9.5" width="5" height="5" rx="1"/></svg><span>Overview</span></a>
          <a href="/?page=upload" class="sidebar-link" data-page="upload"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M5.5 6L8 3.5L10.5 6"/><path d="M8 3.5V10.5"/><path d="M13.5 10v2.5a1 1 0 01-1 1h-9a1 1 0 01-1-1V10"/></svg><span>Ingestion</span></a>
          <a href="/?page=queues" class="sidebar-link" data-page="queues"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 4h12M2 8h12M2 12h12"/><circle cx="5" cy="4" r="1.2" fill="currentColor" stroke="none"/><circle cx="10" cy="8" r="1.2" fill="currentColor" stroke="none"/><circle cx="7" cy="12" r="1.2" fill="currentColor" stroke="none"/></svg><span>Queues</span></a>
        </div>

        <div class="sidebar-group">
          <p class="sidebar-label">Manage</p>
          <a href="/?page=review" class="sidebar-link" data-page="review"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="1.5" width="10" height="13" rx="1.5"/><path d="M6 6l1.5 1.5L10 5"/><path d="M6 10h4"/></svg><span>Human Review</span></a>
          <a href="/?page=rules" class="sidebar-link" data-page="rules"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 3h12"/><path d="M2 8h12"/><path d="M2 13h12"/><circle cx="5" cy="3" r="1.5" fill="var(--surface)" /><circle cx="11" cy="8" r="1.5" fill="var(--surface)" /><circle cx="7" cy="13" r="1.5" fill="var(--surface)" /></svg><span>Routing Rules</span></a>
          <a href="/?page=db-import" class="sidebar-link" data-page="db-import"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><ellipse cx="8" cy="4" rx="5.5" ry="2.5"/><path d="M2.5 4v8c0 1.38 2.46 2.5 5.5 2.5s5.5-1.12 5.5-2.5V4"/><path d="M2.5 8c0 1.38 2.46 2.5 5.5 2.5s5.5-1.12 5.5-2.5"/></svg><span>Database Import</span></a>
        </div>

        <div class="sidebar-group sidebar-group-muted">
          <p class="sidebar-label">Support</p>
          <a href="/docs" class="sidebar-link" target="_blank" rel="noreferrer"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 2.5A1.5 1.5 0 013.5 1H8v6.5L5.75 6 3.5 7.5V1"/><path d="M2 2.5v10A1.5 1.5 0 003.5 14h9a1.5 1.5 0 001.5-1.5v-10A1.5 1.5 0 0012.5 1H8"/></svg><span>Documentation</span></a>
          <a href="mailto:support@citysort.ai" class="sidebar-link"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="8" cy="8" r="6.5"/><circle cx="8" cy="8" r="2"/><path d="M8 1.5v2M8 12.5v2M1.5 8h2M12.5 8h2"/></svg><span>Contact Support</span></a>
        </div>

        <div class="sidebar-footer">
          <span>CitySort AI MVP</span>
          <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme" type="button">
            <svg class="theme-icon-sun" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="8" r="3.5"/><path d="M8 1.5v1.5M8 13v1.5M1.5 8H3M13 8h1.5M3.4 3.4l1.06 1.06M11.54 11.54l1.06 1.06M3.4 12.6l1.06-1.06M11.54 4.46l1.06-1.06"/></svg>
            <svg class="theme-icon-moon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 8.5a5.5 5.5 0 01-7-7A5.5 5.5 0 108.5 13.5a5.5 5.5 0 005-5z"/></svg>
          </button>
        </div>
      </aside>

      <div class="shell-main" id="dashboard">
        <div class="app-toolbar">
          <div class="toolbar-search">
            <input type="search" placeholder="Search settings, logs, and records" aria-label="Search dashboard" />
          </div>
          <div class="toolbar-actions">
            <button type="button" class="secondary" id="docs-btn"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M2 2.5A1.5 1.5 0 013.5 1H8v6.5L5.75 6 3.5 7.5V1"/><path d="M2 2.5v10A1.5 1.5 0 003.5 14h9a1.5 1.5 0 001.5-1.5v-10A1.5 1.5 0 0012.5 1H8"/></svg>Docs</button>
            <button type="button" class="secondary" id="invite-btn"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><circle cx="6" cy="5.5" r="3"/><path d="M1 14c0-2.5 2.24-4.5 5-4.5s5 2 5 4.5"/><path d="M12 5v4M14 7h-4"/></svg>Invite</button>
            <button type="button" id="new-key-btn"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M10.5 1.5l4 4-7 7-4 0 0-4z"/><path d="M9.5 2.5l4 4"/></svg>New API Key</button>
          </div>
        </div>
        <p id="platform-status" class="status platform-status">Platform ready.</p>

        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="/?page=overview">CitySort</a>
          <span class="breadcrumb-sep" aria-hidden="true">/</span>
          <span>Operations</span>
          <span class="breadcrumb-sep" aria-hidden="true">/</span>
          <span class="breadcrumb-current" id="breadcrumb-current">Overview</span>
        </nav>

        <header class="shell-topbar">
          <div class="topbar-main">
            <h1>Overview</h1>
            <p class="subtitle">Classify, validate, route, and review incoming city documents from one control plane.</p>
            <div class="topbar-meta">
              <span class="meta-chip">Python 3</span>
              <span class="meta-chip">Document AI Pipeline</span>
              <span class="meta-chip accent" id="last-updated">Updated: --</span>
            </div>
          </div>
          <div class="hero-tools">
            <div class="topbar-actions">
              <button type="button" class="secondary" id="connect-btn">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><circle cx="8" cy="8" r="6.5"/><path d="M8 4v4l2.5 1.5"/></svg>Connect
              </button>
              <button type="button" id="deploy-btn">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M8 2v12M3 7l5-5 5 5"/></svg>Deploy
              </button>
            </div>
            <button id="refresh" class="secondary">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M2.5 8a5.5 5.5 0 019.5-3.75M13.5 8a5.5 5.5 0 01-9.5 3.75"/><path d="M12 1v3.25h-3.25M4 11.75V15h3.25"/></svg>Refresh
            </button>
          </div>
        </header>

        <nav class="shell-tabs">
          <a href="/?page=overview" class="tab active" data-page="overview">Overview</a>
          <a href="/?page=upload" class="tab" data-page="upload">Ingestion</a>
          <a href="/?page=queues" class="tab" data-page="queues">Queues</a>
          <a href="/?page=review" class="tab" data-page="review">Review</a>
          <a href="/?page=rules" class="tab" data-page="rules">Routing Rules</a>
          <a href="/?page=db-import" class="tab" data-page="db-import">Database Import</a>
        </nav>

        <main class="layout">
          <section class="panel upload-panel" data-pages="overview upload">
            <div class="section-head">
              <h2>Upload Documents</h2>
              <p>Intake pipeline</p>
            </div>
            <form id="upload-form">
              <div class="upload-dropzone" id="upload-dropzone">
                <svg class="dropzone-icon" width="40" height="40" viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 28a8 8 0 01-.8-15.95A11 11 0 0132 16a7 7 0 01-2 13.8"/><path d="M20 18v14"/><path d="M15 23l5-5 5 5"/></svg>
                <p class="dropzone-title">Drag files here to upload</p>
                <p class="dropzone-hint">or <span class="dropzone-browse">browse your files</span></p>
                <p class="dropzone-formats">PDF, DOCX, TXT, images &mdash; up to 25 MB per file</p>
                <input id="file-input" name="file" type="file" multiple required class="dropzone-input" />
              </div>
              <div id="upload-file-list" class="upload-file-list"></div>
              <button type="submit" id="upload-submit-btn" disabled>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.3em"><path d="M5.5 6L8 3.5L10.5 6"/><path d="M8 3.5V10.5"/><path d="M13.5 10v2.5a1 1 0 01-1 1h-9a1 1 0 01-1-1V10"/></svg>Upload &amp; Process
              </button>
            </form>
            <p id="upload-status" class="status"></p>
          </section>

          <section class="panel metrics-panel" data-pages="overview upload">
            <div class="section-head">
              <h2>Operational Metrics</h2>
              <p>Live snapshot</p>
            </div>
            <div class="metrics">
              <article class="metric-card">
                <div class="metric-header">
                  <span>Total Documents</span>
                  <span class="metric-trend" id="metric-total-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-total" class="metric-value">0</strong>
                <div class="metric-bar"><span class="metric-bar-fill" id="metric-total-bar"></span></div>
              </article>
              <article class="metric-card metric-card--warning">
                <div class="metric-header">
                  <span>Needs Review</span>
                  <span class="metric-trend" id="metric-review-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-review" class="metric-value">0</strong>
                <div class="metric-bar metric-bar--warning"><span class="metric-bar-fill" id="metric-review-bar"></span></div>
              </article>
              <article class="metric-card metric-card--success">
                <div class="metric-header">
                  <span>Routed / Approved</span>
                  <span class="metric-trend" id="metric-routed-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-routed" class="metric-value">0</strong>
                <div class="metric-bar metric-bar--success"><span class="metric-bar-fill" id="metric-routed-bar"></span></div>
              </article>
              <article class="metric-card">
                <div class="metric-header">
                  <span>Average Confidence</span>
                  <span class="metric-trend" id="metric-confidence-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-confidence" class="metric-value">0%</strong>
                <div class="metric-bar"><span class="metric-bar-fill" id="metric-confidence-bar"></span></div>
              </article>
            </div>
          </section>

          <section class="panel db-import-panel" data-pages="overview db-import">
            <div class="section-head">
              <h2>Import From Database</h2>
              <p>Simple 3-step setup</p>
            </div>
            <p class="subtitle-small">Paste your database connection and query. We handle the rest with safe defaults.</p>
            <form id="db-import-form">
              <label for="db-url">1. Database URL</label>
              <input
                id="db-url"
                type="text"
                placeholder="postgresql://user:pass@host:5432/dbname"
                required
              />

              <label for="db-query">2. SQL Query (read-only SELECT)</label>
              <textarea id="db-query" rows="4" spellcheck="false">
SELECT filename, content, content_type
FROM documents_to_ingest</textarea
              >

              <label>3. Where is the document data?</label>
              <div class="choice-grid">
                <label class="choice-card" for="db-source-content">
                  <input id="db-source-content" type="radio" name="db-source-mode" value="content" checked />
                  <span class="choice-title">Content column</span>
                  <span class="choice-desc">Your query returns file content directly (best for most setups).</span>
                </label>
                <label class="choice-card" for="db-source-path">
                  <input id="db-source-path" type="radio" name="db-source-mode" value="path" />
                  <span class="choice-title">File path column</span>
                  <span class="choice-desc">Your query returns file paths on this server.</span>
                </label>
              </div>
              <p id="db-source-helper" class="status">Mode: Content column selected.</p>

              <details class="rules-advanced">
                <summary>Advanced Mapping</summary>
                <div class="db-import-grid">
                  <div>
                    <label for="db-filename-column">Filename Column</label>
                    <input id="db-filename-column" type="text" value="filename" />
                  </div>
                  <div>
                    <label for="db-content-column">Content Column</label>
                    <input id="db-content-column" type="text" value="content" />
                  </div>
                  <div>
                    <label for="db-path-column">File Path Column</label>
                    <input id="db-path-column" type="text" placeholder="file_path" />
                  </div>
                  <div>
                    <label for="db-content-type-column">Content-Type Column</label>
                    <input id="db-content-type-column" type="text" value="content_type" />
                  </div>
                  <div>
                    <label for="db-limit">Row Limit</label>
                    <input id="db-limit" type="number" min="1" max="5000" value="500" />
                  </div>
                </div>

                <label class="check-inline" for="db-process-async">
                  <input id="db-process-async" type="checkbox" />
                  Process in background (recommended for large imports)
                </label>
              </details>

              <div class="actions">
                <button id="db-import-submit" type="submit">Start Import</button>
              </div>
            </form>
            <p id="db-import-status" class="status"></p>
          </section>

          <section class="panel queues-panel" data-pages="overview queues">
            <div class="section-head">
              <h2>Department Queues</h2>
              <p>Routing distribution</p>
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>Department</th>
                    <th>Total</th>
                    <th>Needs Review</th>
                    <th>Ready</th>
                  </tr>
                </thead>
                <tbody id="queue-body"></tbody>
              </table>
            </div>
          </section>

          <section class="panel worklist-panel" data-pages="overview queues">
            <div class="section-head">
              <h2>Document Worklist</h2>
              <p>Most recent 200 records</p>
            </div>
            <div class="filters">
              <label for="filter-status">Status</label>
              <select id="filter-status">
                <option value="">All</option>
                <option value="needs_review">needs_review</option>
                <option value="routed">routed</option>
                <option value="approved">approved</option>
                <option value="corrected">corrected</option>
                <option value="failed">failed</option>
              </select>
              <label for="filter-department">Department</label>
              <input id="filter-department" type="text" placeholder="e.g. City Clerk" />
              <label for="filter-search">File Search</label>
              <input id="filter-search" type="text" placeholder="filename..." />
            </div>
            <div class="table-scroll">
              <table>
                <thead>
                  <tr>
                    <th>File</th>
                    <th>Type</th>
                    <th>Department</th>
                    <th>Status</th>
                    <th>Confidence</th>
                    <th>Review</th>
                  </tr>
                </thead>
                <tbody id="docs-body"></tbody>
              </table>
            </div>
          </section>

          <section class="panel review-panel" id="review-panel" data-pages="overview review">
            <div class="section-head">
              <h2>Review Document</h2>
              <p>Quick decision flow</p>
            </div>
            <p class="subtitle-small">Pick a document from the worklist, then approve or send it back to review.</p>
            <div class="review-context">
              <p id="review-selected">Select a document from the worklist.</p>
              <div class="review-tags">
                <span id="review-current-status">Status: -</span>
                <span id="review-current-type">Type: -</span>
                <span id="review-current-department">Department: -</span>
                <span id="review-current-confidence">Confidence: -</span>
              </div>
            </div>

            <div class="review-columns">
              <div>
                <label for="review-missing">Missing Required Fields</label>
                <pre id="review-missing" class="mono-block">-</pre>
              </div>
              <div>
                <label for="review-errors">Validation Errors</label>
                <pre id="review-errors" class="mono-block">-</pre>
              </div>
            </div>

            <form id="review-form">
              <input type="hidden" id="review-id" />

              <label for="review-doc-type">Correct type (only if wrong)</label>
              <select id="review-doc-type">
                <option value="">(No change)</option>
                <option value="building_permit">building_permit</option>
                <option value="business_license">business_license</option>
                <option value="foi_request">foi_request</option>
                <option value="zoning_variance">zoning_variance</option>
                <option value="complaint">complaint</option>
                <option value="benefits_application">benefits_application</option>
                <option value="court_filing">court_filing</option>
                <option value="other">other</option>
              </select>

              <label for="review-department">Correct department (optional)</label>
              <input id="review-department" type="text" placeholder="Leave blank to keep current" />

              <label for="review-notes">Reviewer notes (optional)</label>
              <textarea id="review-notes" rows="3" placeholder="Brief reason for your decision"></textarea>

              <div class="actions">
                <button type="submit">Approve</button>
                <button type="button" id="reject" class="secondary">Keep In Review</button>
                <button type="button" id="reprocess" class="secondary">Reprocess</button>
              </div>

              <details class="rules-advanced review-advanced">
                <summary>Advanced Details</summary>

                <label for="review-fields-json">Corrected Fields (JSON)</label>
                <textarea id="review-fields-json" rows="7" spellcheck="false">{}</textarea>

                <label for="review-text-preview">Extracted Text Preview</label>
                <pre id="review-text-preview" class="mono-block">-</pre>

                <label for="review-audit">Audit Trail (Latest First)</label>
                <pre id="review-audit" class="mono-block">-</pre>
              </details>
            </form>
            <p id="review-status" class="status"></p>
          </section>

          <section class="panel rules-panel" data-pages="overview rules">
            <div class="section-head">
              <h2>Routing Rules</h2>
              <p>Plain-language setup</p>
            </div>
            <p class="subtitle-small">
              For each document type, choose the destination department and a few trigger keywords.
            </p>
            <p id="rules-meta" class="status">Source: -</p>
            <div class="actions">
              <button type="button" id="rules-add" class="secondary">Add Type</button>
              <button type="button" id="rules-save">Save Rules</button>
              <button type="button" id="rules-reset" class="secondary">Reset Defaults</button>
              <button type="button" id="rules-load" class="secondary">Reload</button>
            </div>

            <div id="rules-builder" class="rules-builder"></div>

            <details class="rules-advanced">
              <summary>Advanced Rule Options</summary>
              <p class="subtitle-small">Use this only if you need full JSON editing.</p>
              <div class="actions">
                <button type="button" id="rules-apply-json" class="secondary">Apply JSON To Form</button>
              </div>
              <label for="rules-json">Rules JSON</label>
              <textarea id="rules-json" rows="14" spellcheck="false">{}</textarea>
            </details>
            <p id="rules-status" class="status"></p>
          </section>
        </main>
      </div>
    </div>

    <script>
      (() => {
        const pageConfig = {
          overview: {
            title: "Overview",
            subtitle: "Operational snapshot across ingestion, queue health, review workload, and routing outcomes.",
          },
          upload: {
            title: "Ingestion",
            subtitle: "Upload and process document batches while monitoring throughput and confidence in real time.",
          },
          queues: {
            title: "Queues",
            subtitle: "Track department queue distribution, search records, and prioritize routing operations.",
          },
          "db-import": {
            title: "Database Import",
            subtitle: "Connect a source database and ingest records directly into the CitySort processing pipeline.",
          },
          review: {
            title: "Human Review",
            subtitle: "Review low-confidence documents and apply corrections with full audit visibility.",
          },
          rules: {
            title: "Routing Rules",
            subtitle: "Manage classification policy, required fields, and department routing behavior for new intake.",
          },
        };

        const requestedPage = (new URLSearchParams(window.location.search).get("page") || "overview").trim().toLowerCase();
        const activePage = Object.prototype.hasOwnProperty.call(pageConfig, requestedPage) ? requestedPage : "overview";

        const titleEl = document.querySelector(".shell-topbar h1");
        const subtitleEl = document.querySelector(".shell-topbar .subtitle");
        const meta = pageConfig[activePage];
        if (titleEl && meta) titleEl.textContent = meta.title;
        if (subtitleEl && meta) subtitleEl.textContent = meta.subtitle;

        const breadcrumbEl = document.getElementById("breadcrumb-current");
        if (breadcrumbEl && meta) breadcrumbEl.textContent = meta.title;

        document.querySelectorAll(".sidebar-link[data-page], .tab[data-page]").forEach((link) => {
          const isActive = link.dataset.page === activePage;
          link.classList.toggle("active", isActive);
          if (isActive) {
            link.setAttribute("aria-current", "page");
          } else {
            link.removeAttribute("aria-current");
          }
        });

        document.querySelectorAll(".panel[data-pages]").forEach((panel) => {
          const pages = (panel.dataset.pages || "").split(/\s+/).filter(Boolean);
          const isVisible = pages.includes(activePage);
          panel.classList.toggle("is-page-hidden", !isVisible);
        });
      })();
    </script>
    <div id="toast-container" class="toast-container" aria-live="polite"></div>
    <script src="/static/app.v2.js"></script>
  </body>
</html>
