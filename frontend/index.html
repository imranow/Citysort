<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CitySort AI MVP</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&family=IBM+Plex+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <script>
      (() => {
        const root = document.documentElement;
        const THEME_KEY = "citysort_theme";
        const saved = localStorage.getItem(THEME_KEY);
        const applyTimeTheme = () => {
          if (localStorage.getItem(THEME_KEY)) return;
          const hour = new Date().getHours();
          const isDark = hour >= 19 || hour < 7;
          root.setAttribute("data-theme", isDark ? "dark" : "light");
        };
        if (saved) { root.setAttribute("data-theme", saved); } else { applyTimeTheme(); }
        window.setInterval(applyTimeTheme, 60000);
        window._toggleTheme = () => {
          const current = root.getAttribute("data-theme") || "light";
          const next = current === "dark" ? "light" : "dark";
          root.setAttribute("data-theme", next);
          localStorage.setItem(THEME_KEY, next);
        };
      })();
    </script>
    <style>
      /* Critical fallback — keeps shell usable before external CSS loads */
      :root {
        --bg: #f2f4f8; --surface: #ffffff; --surface-muted: #f7f9fc;
        --line: #d8dee8; --ink: #2d3544; --ink-soft: #657286;
        --accent: #c3ccd9; --accent-strong: #5f6d82; --accent-soft: #edf2f8;
        --primary-btn-bg: #d4dbe7; --primary-btn-text: #2f394c;
        --sidebar-bg: #f5f7fa; --sidebar-ink: #667388; --sidebar-ink-strong: #2f394c;
        --sidebar-line: #d8dee8; --sidebar-surface: #ffffff;
        --sidebar-active-bg: #e7edf5; --sidebar-active-ink: #3e4a5f;
      }
      html[data-theme="dark"] {
        --bg: #edf1f6; --surface: #fbfcfe; --surface-muted: #f3f6fa;
        --line: #d2dae6; --ink: #2a3343; --ink-soft: #5f6d82;
        --accent: #bcc7d6; --accent-strong: #56657c; --accent-soft: #e8eef6;
        --primary-btn-bg: #ced7e4; --primary-btn-text: #2c3649;
        --sidebar-bg: #f1f4f9; --sidebar-ink: #637086; --sidebar-ink-strong: #2c3649;
        --sidebar-line: #d2dae6; --sidebar-surface: #fbfcfe;
        --sidebar-active-bg: #e3eaf3; --sidebar-active-ink: #39465b;
      }
      html, body { margin:0; min-height:100%; font-size:15px; background:var(--bg); color:var(--ink); font-family:"IBM Plex Sans","Segoe UI",-apple-system,sans-serif; }
      a { color:inherit; text-decoration:none; }
      .app-shell { min-height:100vh; display:grid; grid-template-columns:272px 1fr; }
      .shell-sidebar { background:var(--sidebar-bg); padding:0.875rem 0.75rem; }
      .sidebar-link { display:flex; align-items:center; gap:0.5rem; color:var(--sidebar-ink); padding:0.5rem 0.625rem; }
      .sidebar-link.active { background:var(--sidebar-active-bg); color:var(--sidebar-active-ink); }
      .sidebar-service, .sidebar-account { border:1px solid var(--sidebar-line); background:var(--sidebar-surface); padding:0.5rem; }
      .account-avatar { width:1.875rem; height:1.875rem; display:grid; place-items:center; background:var(--sidebar-active-bg); color:var(--sidebar-active-ink); font-weight:700; }
      .shell-main { padding:1.5rem 2rem; }
      .app-toolbar { display:flex; gap:0.75rem; justify-content:space-between; margin-bottom:1rem; }
      .toolbar-search { flex:1; }
      .toolbar-actions { display:flex; gap:0.375rem; }
      .platform-status { margin:0 0 1rem; border:1px solid var(--line); padding:0.5rem 0.75rem; background:var(--surface); }
      .shell-topbar { border:1px solid var(--line); background:var(--surface); padding:1.25rem 1.5rem; }
      .topbar-meta { margin-top:0.75rem; display:flex; flex-wrap:wrap; gap:0.375rem; }
      .meta-chip { display:inline-flex; border:1px solid var(--line); background:var(--surface-muted); color:var(--ink-soft); font-size:0.75rem; padding:0.25rem 0.5rem; }
      .meta-chip.accent { border-color:var(--accent); background:var(--accent-soft); color:var(--accent-strong); }
      .shell-tabs { margin-top:1rem; display:flex; border-bottom:1px solid var(--line); overflow-x:auto; }
      .topbar-actions { display:flex; gap:0.375rem; justify-content:flex-end; }
      .tab { color:var(--ink-soft); padding:0.6875rem 1rem; border-bottom:2px solid transparent; white-space:nowrap; }
      .tab.active { color:var(--accent-strong); border-color:var(--accent); }
      .layout { margin-top:1.25rem; display:grid; grid-template-columns:repeat(12,minmax(0,1fr)); gap:1rem; }
      .panel { border:1px solid var(--line); background:var(--surface); padding:1.25rem; }
      .link-icon { width:1rem; height:1rem; flex:0 0 auto; opacity:0.7; }
      .panel.is-page-hidden { display:none; }
      .upload-panel { grid-column:span 4; } .metrics-panel { grid-column:span 8; }
      .connectors-panel, .document-review-panel, .rules-panel { grid-column:span 12; }
      .queue-summary-panel, .review-summary-panel { grid-column:span 6; }
      @media (max-width:1320px) { .upload-panel,.metrics-panel,.queue-summary-panel,.review-summary-panel { grid-column:span 12; } }
      @media (max-width:1040px) { .app-shell { grid-template-columns:1fr; } html,body { font-size:14px; } .app-toolbar { flex-direction:column; } }
    </style>
    <link rel="stylesheet" href="/static/styles.v2.css?v=20260210e" />
  </head>
  <body>
    <div class="app-shell">
      <aside class="shell-sidebar">
        <div class="sidebar-brand">
          <div class="brand-mark" aria-hidden="true">CS</div>
          <div>
            <p class="sidebar-kicker">CitySort</p>
            <strong>Operations Suite</strong>
          </div>
        </div>

        <div class="sidebar-account">
          <div class="account-avatar" aria-hidden="true">P</div>
          <div class="account-meta">
            <strong>Personal</strong>
            <span>citysort workspace</span>
          </div>
        </div>

        <div class="sidebar-service">
          <span class="sidebar-service-label">Service</span>
          <strong>citysort</strong>
          <span class="sidebar-service-meta">Python 3 · Managed</span>
          <a href="/?page=overview" class="sidebar-home">Open overview</a>
        </div>

        <div class="sidebar-group">
          <p class="sidebar-label">Monitor</p>
          <a href="/?page=overview" class="sidebar-link active" data-page="overview"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="1.5" y="1.5" width="5" height="5" rx="1"/><rect x="9.5" y="1.5" width="5" height="5" rx="1"/><rect x="1.5" y="9.5" width="5" height="5" rx="1"/><rect x="9.5" y="9.5" width="5" height="5" rx="1"/></svg><span>Overview</span></a>
          <a href="/?page=upload" class="sidebar-link" data-page="upload"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M5.5 6L8 3.5L10.5 6"/><path d="M8 3.5V10.5"/><path d="M13.5 10v2.5a1 1 0 01-1 1h-9a1 1 0 01-1-1V10"/></svg><span>Ingestion</span></a>
          <a href="/?page=queues" class="sidebar-link" data-page="queues"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><rect x="3" y="1.5" width="10" height="13" rx="1.5"/><path d="M6 6l1.5 1.5L10 5"/><path d="M6 10h4"/></svg><span>Document Review</span></a>
        </div>

        <div class="sidebar-group">
          <p class="sidebar-label">Manage</p>
          <a href="/?page=rules" class="sidebar-link" data-page="rules"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 3h12"/><path d="M2 8h12"/><path d="M2 13h12"/><circle cx="5" cy="3" r="1.5" fill="var(--surface)" /><circle cx="11" cy="8" r="1.5" fill="var(--surface)" /><circle cx="7" cy="13" r="1.5" fill="var(--surface)" /></svg><span>Routing Rules</span></a>
          <a href="/?page=connectors" class="sidebar-link" data-page="connectors"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M6 3H3v4h3M10 3h3v4h-3M6 5h4M6 9H3v4h3M10 9h3v4h-3M6 11h4"/></svg><span>Connectors</span></a>
        </div>

        <div class="sidebar-group sidebar-group-muted">
          <p class="sidebar-label">Support</p>
          <a href="/docs" class="sidebar-link" target="_blank" rel="noreferrer"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M2 2.5A1.5 1.5 0 013.5 1H8v6.5L5.75 6 3.5 7.5V1"/><path d="M2 2.5v10A1.5 1.5 0 003.5 14h9a1.5 1.5 0 001.5-1.5v-10A1.5 1.5 0 0012.5 1H8"/></svg><span>Documentation</span></a>
          <a href="mailto:support@citysort.ai" class="sidebar-link"><svg class="link-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><circle cx="8" cy="8" r="6.5"/><circle cx="8" cy="8" r="2"/><path d="M8 1.5v2M8 12.5v2M1.5 8h2M12.5 8h2"/></svg><span>Contact Support</span></a>
        </div>

        <div class="sidebar-footer">
          <button type="button" id="sidebar-toggle" class="sidebar-collapse-btn" aria-label="Collapse sidebar" title="Collapse sidebar">
            <svg class="sidebar-collapse-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M11 3L6 8l5 5"/></svg>
            <svg class="sidebar-expand-icon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M5 3l5 5-5 5"/></svg>
          </button>
          <span class="sidebar-footer-label">CitySort AI MVP</span>
          <div class="sidebar-footer-actions">
            <button id="notification-bell" class="notification-bell" aria-label="Toggle notifications" type="button">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2.5a3 3 0 00-3 3V7c0 1-.36 1.97-1.02 2.72L3 10.75V12h10v-1.25l-.98-1.03A4.02 4.02 0 0111 7V5.5a3 3 0 00-3-3z"/><path d="M6.5 13.5a1.5 1.5 0 003 0"/></svg>
              <span id="notification-badge" class="notification-badge" hidden>0</span>
            </button>
            <button class="theme-toggle" id="theme-toggle" aria-label="Toggle theme" type="button">
              <svg class="theme-icon-sun" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><circle cx="8" cy="8" r="3.5"/><path d="M8 1.5v1.5M8 13v1.5M1.5 8H3M13 8h1.5M3.4 3.4l1.06 1.06M11.54 11.54l1.06 1.06M3.4 12.6l1.06-1.06M11.54 4.46l1.06-1.06"/></svg>
              <svg class="theme-icon-moon" width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.4" stroke-linecap="round" stroke-linejoin="round"><path d="M13.5 8.5a5.5 5.5 0 01-7-7A5.5 5.5 0 108.5 13.5a5.5 5.5 0 005-5z"/></svg>
            </button>
          </div>
          <div id="notification-panel" class="notification-panel" hidden>
            <div class="notification-panel-head">
              <strong>Notifications</strong>
              <button type="button" id="notifications-mark-all" class="secondary notification-panel-action">Mark all read</button>
            </div>
            <div id="notification-list" class="notification-list"></div>
          </div>
        </div>
      </aside>

      <div class="shell-main" id="dashboard">
        <div class="app-toolbar">
          <div class="toolbar-search">
            <input type="search" placeholder="Search settings, logs, and records" aria-label="Search dashboard" />
          </div>
          <div class="toolbar-actions">
            <button type="button" class="secondary" id="docs-btn"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M2 2.5A1.5 1.5 0 013.5 1H8v6.5L5.75 6 3.5 7.5V1"/><path d="M2 2.5v10A1.5 1.5 0 003.5 14h9a1.5 1.5 0 001.5-1.5v-10A1.5 1.5 0 0012.5 1H8"/></svg>Docs</button>
            <button type="button" class="secondary" id="invite-btn"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><circle cx="6" cy="5.5" r="3"/><path d="M1 14c0-2.5 2.24-4.5 5-4.5s5 2 5 4.5"/><path d="M12 5v4M14 7h-4"/></svg>Invite</button>
            <button type="button" id="new-key-btn"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M10.5 1.5l4 4-7 7-4 0 0-4z"/><path d="M9.5 2.5l4 4"/></svg>New API Key</button>
          </div>
        </div>
        <p id="platform-status" class="status platform-status">Platform ready.</p>

        <nav class="breadcrumb" aria-label="Breadcrumb">
          <a href="/?page=overview">CitySort</a>
          <span class="breadcrumb-sep" aria-hidden="true">/</span>
          <span>Operations</span>
          <span class="breadcrumb-sep" aria-hidden="true">/</span>
          <span class="breadcrumb-current" id="breadcrumb-current">Overview</span>
        </nav>

        <header class="shell-topbar">
          <div class="topbar-main">
            <h1>Overview</h1>
            <p class="subtitle">Classify, validate, route, and review incoming city documents from one control plane.</p>
            <div class="topbar-meta">
              <span class="meta-chip">Python 3</span>
              <span class="meta-chip">Document AI Pipeline</span>
              <span class="meta-chip accent" id="last-updated">Updated: --</span>
            </div>
          </div>
          <div class="hero-tools">
            <div class="topbar-actions">
              <button type="button" class="secondary" id="connect-btn">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><circle cx="8" cy="8" r="6.5"/><path d="M8 4v4l2.5 1.5"/></svg>Connect
              </button>
              <button type="button" id="deploy-btn">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M8 2v12M3 7l5-5 5 5"/></svg>Deploy
              </button>
            </div>
            <button id="refresh" class="secondary">
              <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M2.5 8a5.5 5.5 0 019.5-3.75M13.5 8a5.5 5.5 0 01-9.5 3.75"/><path d="M12 1v3.25h-3.25M4 11.75V15h3.25"/></svg>Refresh
            </button>
          </div>
        </header>

        <nav class="shell-tabs">
          <a href="/?page=overview" class="tab active" data-page="overview">Overview</a>
          <a href="/?page=upload" class="tab" data-page="upload">Ingestion</a>
          <a href="/?page=queues" class="tab" data-page="queues">Document Review</a>
          <a href="/?page=rules" class="tab" data-page="rules">Routing Rules</a>
          <a href="/?page=connectors" class="tab" data-page="connectors">Connectors</a>
        </nav>

        <main class="layout">
          <section class="panel upload-panel" data-pages="overview upload">
            <div class="section-head">
              <h2>Upload Documents</h2>
              <p>Intake pipeline</p>
            </div>
            <form id="upload-form">
              <div class="upload-dropzone" id="upload-dropzone">
                <svg class="dropzone-icon" width="40" height="40" viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 28a8 8 0 01-.8-15.95A11 11 0 0132 16a7 7 0 01-2 13.8"/><path d="M20 18v14"/><path d="M15 23l5-5 5 5"/></svg>
                <p class="dropzone-title">Drag files here to upload</p>
                <p class="dropzone-hint">or <span class="dropzone-browse">browse your files</span></p>
                <p class="dropzone-formats">PDF, DOCX, TXT, images &mdash; up to 25 MB per file</p>
                <input id="file-input" name="file" type="file" multiple required class="dropzone-input" />
              </div>
              <div id="upload-file-list" class="upload-file-list"></div>
              <button type="submit" id="upload-submit-btn" disabled>
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true" style="vertical-align:-0.12em;margin-right:0.3em"><path d="M5.5 6L8 3.5L10.5 6"/><path d="M8 3.5V10.5"/><path d="M13.5 10v2.5a1 1 0 01-1 1h-9a1 1 0 01-1-1V10"/></svg>Upload &amp; Process
              </button>
            </form>
            <p id="upload-status" class="status"></p>
          </section>

          <section class="panel metrics-panel" data-pages="overview upload">
            <div class="section-head">
              <h2>Operational Metrics</h2>
              <p>Live snapshot</p>
            </div>
            <div class="metrics">
              <article class="metric-card">
                <div class="metric-header">
                  <span>Total Documents</span>
                  <span class="metric-trend" id="metric-total-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-total" class="metric-value">0</strong>
                <div class="metric-bar"><span class="metric-bar-fill" id="metric-total-bar"></span></div>
              </article>
              <article class="metric-card metric-card--warning">
                <div class="metric-header">
                  <span>Needs Review</span>
                  <span class="metric-trend" id="metric-review-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-review" class="metric-value">0</strong>
                <div class="metric-bar metric-bar--warning"><span class="metric-bar-fill" id="metric-review-bar"></span></div>
              </article>
              <article class="metric-card metric-card--warning">
                <div class="metric-header">
                  <span>Overdue</span>
                  <span class="metric-trend" id="metric-overdue-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-overdue" class="metric-value">0</strong>
                <div class="metric-bar metric-bar--warning"><span class="metric-bar-fill" id="metric-overdue-bar"></span></div>
              </article>
              <article class="metric-card metric-card--success">
                <div class="metric-header">
                  <span>Routed / Approved</span>
                  <span class="metric-trend" id="metric-routed-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-routed" class="metric-value">0</strong>
                <div class="metric-bar metric-bar--success"><span class="metric-bar-fill" id="metric-routed-bar"></span></div>
              </article>
              <article class="metric-card metric-card--success">
                <div class="metric-header">
                  <span>Automation Rate</span>
                  <span class="metric-trend" id="metric-automation-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-automation" class="metric-value">0%</strong>
                <div class="metric-bar metric-bar--success"><span class="metric-bar-fill" id="metric-automation-bar"></span></div>
              </article>
              <article class="metric-card">
                <div class="metric-header">
                  <span>Average Confidence</span>
                  <span class="metric-trend" id="metric-confidence-trend" aria-hidden="true">
                    <svg width="12" height="12" viewBox="0 0 12 12" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><path d="M2 8l4-4 4 4"/></svg>
                  </span>
                </div>
                <strong id="metric-confidence" class="metric-value">0%</strong>
                <div class="metric-bar"><span class="metric-bar-fill" id="metric-confidence-bar"></span></div>
              </article>
            </div>
          </section>

          <section class="panel connectors-panel" data-pages="overview connectors">
            <div class="section-head">
              <h2>Connectors</h2>
              <p>Data sources</p>
            </div>
            <div id="watcher-status" class="watcher-status">Watcher: checking...</div>

            <!-- Connector Grid View (default) -->
            <div id="connectors-grid" class="connectors-grid"></div>

            <!-- Connector Config View (hidden by default) -->
            <div id="connector-config" style="display:none;">
              <button type="button" id="connector-back" class="connector-back secondary">
                <svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M10 3L5 8l5 5"/></svg>Back to Connectors
              </button>

              <div class="connector-config-header" id="connector-config-header"></div>

              <form id="connector-config-form">
                <div id="connector-config-fields"></div>

                <!-- Query section (DB connectors only) -->
                <div id="connector-query-section" style="display:none;">
                  <label for="connector-query">SQL Query (read-only SELECT)</label>
                  <textarea id="connector-query" rows="4" spellcheck="false">SELECT filename, content, content_type
FROM documents_to_ingest</textarea>

                  <label>Where is the document data?</label>
                  <div class="choice-grid">
                    <label class="choice-card" for="connector-source-content">
                      <input id="connector-source-content" type="radio" name="connector-source-mode" value="content" checked />
                      <span class="choice-title">Content column</span>
                      <span class="choice-desc">Your query returns file content directly.</span>
                    </label>
                    <label class="choice-card" for="connector-source-path">
                      <input id="connector-source-path" type="radio" name="connector-source-mode" value="path" />
                      <span class="choice-title">File path column</span>
                      <span class="choice-desc">Your query returns file paths on this server.</span>
                    </label>
                  </div>

                  <details class="rules-advanced">
                    <summary>Advanced Mapping</summary>
                    <div class="connector-fields-grid">
                      <div class="connector-field">
                        <label for="connector-filename-col">Filename Column</label>
                        <input id="connector-filename-col" type="text" value="filename" />
                      </div>
                      <div class="connector-field">
                        <label for="connector-content-col">Content Column</label>
                        <input id="connector-content-col" type="text" value="content" />
                      </div>
                      <div class="connector-field">
                        <label for="connector-path-col">File Path Column</label>
                        <input id="connector-path-col" type="text" placeholder="file_path" />
                      </div>
                      <div class="connector-field">
                        <label for="connector-content-type-col">Content-Type Column</label>
                        <input id="connector-content-type-col" type="text" value="content_type" />
                      </div>
                      <div class="connector-field">
                        <label for="connector-limit">Row Limit</label>
                        <input id="connector-limit" type="number" min="1" max="5000" value="500" />
                      </div>
                    </div>
                    <label class="check-inline" for="connector-process-async">
                      <input id="connector-process-async" type="checkbox" />
                      Process in background (recommended for large imports)
                    </label>
                  </details>
                </div>

                <div class="actions connector-actions">
                  <button type="button" id="connector-test-btn" class="secondary">Test Connection</button>
                  <button type="submit" id="connector-import-btn">Import Documents</button>
                </div>
              </form>
              <p id="connector-status" class="status"></p>
            </div>
          </section>

          <!-- Overview-only: Queue Summary -->
          <section class="panel queue-summary-panel" data-pages="overview">
            <div class="section-head">
              <h2>Department Queues</h2>
              <a href="/?page=queues" class="section-link">View all →</a>
            </div>
            <div id="queue-summary-body" class="queue-chips"></div>
          </section>

          <!-- Overview-only: Needs Review Summary -->
          <section class="panel review-summary-panel" data-pages="overview">
            <div class="section-head">
              <h2>Needs Review</h2>
              <a href="/?page=queues" class="section-link">Review all →</a>
            </div>
            <div id="review-summary-body" class="review-summary-list"></div>
          </section>

          <!-- Unified Document Review (split-pane) -->
          <section class="panel document-review-panel" data-pages="queues review">
            <div class="section-head">
              <h2>Document Review</h2>
              <p>Queue-based review</p>
            </div>

            <div id="automation-assistant" class="automation-assistant">
              <div class="automation-assistant-summary">
                <strong id="automation-inline-rate">Automation: 0%</strong>
                <span id="automation-inline-gap">Manual workload: 0 docs</span>
              </div>
              <div class="automation-assistant-breakdown">
                <span id="automation-inline-needs-review" class="pill">Needs Review: 0</span>
                <span id="automation-inline-unassigned" class="pill">Unassigned: 0</span>
                <span id="automation-inline-missing-contact" class="pill">Missing Contact: 0</span>
              </div>
              <div class="automation-assistant-actions">
                <button type="button" id="automation-auto-assign" class="secondary">Auto-Assign Unassigned</button>
                <button type="button" id="automation-anthropic-sweep" class="secondary">Anthropic Auto-Fill Queue</button>
                <span id="automation-assistant-status" class="status"></span>
              </div>
            </div>

            <!-- Department queue chips (clickable filters) -->
            <div id="queue-chips" class="queue-chips"></div>

            <!-- Split pane -->
            <div class="review-split">
              <!-- LEFT: Document list -->
              <div class="review-list-pane" id="review-list-pane">
                <div class="review-list-toolbar">
                  <div class="review-list-filters">
                    <select id="filter-status">
                      <option value="">All statuses</option>
                      <option value="needs_review">Needs review</option>
                      <option value="routed">Routed</option>
                      <option value="acknowledged">Acknowledged</option>
                      <option value="assigned">Assigned</option>
                      <option value="in_progress">In Progress</option>
                      <option value="completed">Completed</option>
                      <option value="approved">Approved</option>
                      <option value="corrected">Corrected</option>
                      <option value="archived">Archived</option>
                      <option value="failed">Failed</option>
                      <option value="overdue">Overdue</option>
                    </select>
                    <input id="filter-search" type="text" placeholder="Search files…" />
                  </div>
                  <div class="review-list-actions">
                    <button type="button" id="my-docs-chip" class="filter-chip">My Documents</button>
                    <button type="button" id="bulk-toggle" class="secondary">Multi-select</button>
                  </div>
                  <div id="bulk-toolbar" class="bulk-toolbar" hidden>
                    <label class="bulk-check" for="bulk-select-all">
                      <input id="bulk-select-all" type="checkbox" />
                      Select All
                    </label>
                    <span id="bulk-selected-count" class="review-list-count">0 selected</span>
                    <div class="bulk-actions">
                      <button type="button" id="bulk-approve">Approve</button>
                      <button type="button" id="bulk-assign" class="secondary">Assign</button>
                      <button type="button" id="bulk-export" class="secondary">Export CSV</button>
                      <button type="button" id="bulk-cancel" class="secondary">Cancel</button>
                    </div>
                  </div>
                  <span class="review-list-count" id="review-list-count">0 documents</span>
                </div>
                <div class="review-list-scroll" id="review-list-scroll"></div>
              </div>

              <!-- RIGHT: Review detail -->
              <div class="review-detail-pane" id="review-detail-pane">
                <!-- Empty state -->
                <div class="review-empty-state" id="review-empty-state">
                  <svg width="40" height="40" viewBox="0 0 40 40" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><rect x="8" y="4" width="24" height="32" rx="3"/><path d="M15 16h10M15 22h10M15 28h6"/><path d="M20 4v6"/></svg>
                  <p>Select a document to review</p>
                </div>

                <!-- Detail content (hidden until selection) -->
                <div id="review-detail-content" style="display:none">
                  <!-- Document header -->
                  <div class="review-detail-header">
                    <h3 id="review-filename" class="review-detail-title">-</h3>
                    <div class="review-detail-meta">
                      <span id="review-badge-status" class="status-badge">-</span>
                      <span id="review-badge-type" class="pill">-</span>
                      <span id="review-badge-dept" class="review-meta-text">-</span>
                      <span id="review-badge-confidence" class="review-meta-text">
                        <span class="confidence-track" style="width:60px"><span id="review-conf-bar" style="width:0%"></span></span>
                        <span id="review-conf-pct">0%</span>
                      </span>
                      <span id="review-due-date" class="due-date-text">Due: -</span>
                    </div>
                  </div>

                  <!-- Issues (hidden when empty) -->
                  <div class="review-issues" id="review-issues" style="display:none">
                    <p class="review-issues-title">Issues Found</p>
                    <div class="review-issues-grid">
                      <div id="review-missing-section">
                        <label>Missing Fields</label>
                        <pre id="review-missing" class="mono-block">-</pre>
                      </div>
                      <div id="review-errors-section">
                        <label>Validation Errors</label>
                        <pre id="review-errors" class="mono-block">-</pre>
                      </div>
                    </div>
                  </div>

                  <!-- Detail-pane tabs -->
                  <div class="detail-tabs" id="detail-tabs">
                    <button type="button" class="detail-tab active" data-detail-tab="review">Review</button>
                    <button type="button" class="detail-tab" data-detail-tab="document">Document</button>
                  </div>

                  <!-- Tab panel: Review -->
                  <div class="detail-tab-panel active" id="detail-panel-review" data-detail-panel="review">
                    <form id="review-form">
                      <input type="hidden" id="review-id" />

                      <label for="review-doc-type">Correct type (only if wrong)</label>
                      <select id="review-doc-type">
                        <option value="">(No change)</option>
                        <option value="building_permit">building_permit</option>
                        <option value="business_license">business_license</option>
                        <option value="foi_request">foi_request</option>
                        <option value="zoning_variance">zoning_variance</option>
                        <option value="complaint">complaint</option>
                        <option value="benefits_application">benefits_application</option>
                        <option value="court_filing">court_filing</option>
                        <option value="other">other</option>
                      </select>

                      <label for="review-department">Correct department (optional)</label>
                      <input id="review-department" type="text" placeholder="Leave blank to keep current" />

                      <label for="review-assigned-to">Assign to</label>
                      <select id="review-assigned-to">
                        <option value="">(Unassigned)</option>
                      </select>

                      <label for="review-notes">Reviewer notes (optional)</label>
                      <textarea id="review-notes" rows="2" placeholder="Brief reason for your decision"></textarea>

                      <div class="actions">
                        <button type="submit">Approve</button>
                        <button type="button" id="reject" class="secondary">Keep In Review</button>
                        <button type="button" id="reprocess" class="secondary">Reprocess</button>
                        <button type="button" id="respond-btn" class="secondary">Respond by Email</button>
                      </div>
                      <div id="transition-actions" class="transition-actions"></div>

                      <details class="rules-advanced review-advanced">
                        <summary>Advanced Details</summary>

                        <label for="review-fields-json">Corrected Fields (JSON)</label>
                        <textarea id="review-fields-json" rows="5" spellcheck="false">{}</textarea>

                        <label for="review-audit">Audit Trail</label>
                        <pre id="review-audit" class="mono-block">-</pre>
                      </details>
                    </form>
                    <p id="review-status" class="status"></p>
                  </div>

                  <!-- Tab panel: Document -->
                  <div class="detail-tab-panel" id="detail-panel-document" data-detail-panel="document">
                    <div class="doc-tab-toolbar">
                      <button type="button" id="doc-download-btn" class="secondary"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.12em;margin-right:0.3em"><path d="M8 2v8.5M4.5 7.5L8 11l3.5-3.5"/><path d="M2.5 11v2.5a1 1 0 001 1h9a1 1 0 001-1V11"/></svg>Download Original</button>
                      <label class="doc-reupload-label secondary" for="doc-reupload-input"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.12em;margin-right:0.3em"><path d="M5.5 6L8 3.5L10.5 6"/><path d="M8 3.5V10.5"/><path d="M13.5 10v2.5a1 1 0 01-1 1h-9a1 1 0 01-1-1V10"/></svg>Re-upload</label>
                      <input type="file" id="doc-reupload-input" class="dropzone-input" />
                    </div>
                    <p id="doc-reupload-status" class="status"></p>

                    <div class="doc-text-section">
                      <label>Extracted Text (OCR)</label>
                      <pre id="doc-text-preview" class="mono-block doc-text-block">-</pre>
                    </div>

                    <div class="doc-fields-section">
                      <div class="doc-fields-header">
                        <label>Extracted Fields</label>
                        <button type="button" id="doc-fields-save" class="secondary" disabled>Save Changes</button>
                      </div>
                      <div id="doc-fields-editor" class="doc-fields-editor"></div>
                      <p id="doc-fields-status" class="status"></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <section class="panel rules-panel" data-pages="overview rules">
            <div class="section-head">
              <h2>Routing Rules</h2>
              <div class="rules-toolbar">
                <button type="button" id="rules-add" class="secondary"><svg width="14" height="14" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align:-0.12em;margin-right:0.25em"><path d="M8 3v10M3 8h10"/></svg>Add Rule</button>
                <button type="button" id="rules-save">Save Rules</button>
              </div>
            </div>

            <div id="rules-builder" class="rules-builder"></div>

            <div class="rules-footer">
              <p id="rules-meta" class="status">Source: -</p>
              <div class="rules-footer-actions">
                <button type="button" id="rules-reset" class="secondary">Reset Defaults</button>
                <button type="button" id="rules-load" class="secondary">Reload</button>
              </div>
            </div>

            <details class="rules-advanced">
              <summary>JSON Editor</summary>
              <div class="actions">
                <button type="button" id="rules-apply-json" class="secondary">Apply JSON To Form</button>
              </div>
              <label for="rules-json">Rules JSON</label>
              <textarea id="rules-json" rows="10" spellcheck="false">{}</textarea>
            </details>
            <p id="rules-status" class="status"></p>
          </section>
        </main>
      </div>
    </div>

    <script>
      (() => {
        const pageConfig = {
          overview: {
            title: "Overview",
            subtitle: "Operational snapshot across ingestion, queue health, review workload, and routing outcomes.",
          },
          upload: {
            title: "Ingestion",
            subtitle: "Upload and process document batches while monitoring throughput and confidence in real time.",
          },
          queues: {
            title: "Document Review",
            subtitle: "Review, approve, and route documents across department queues.",
          },
          connectors: {
            title: "Connectors",
            subtitle: "Connect databases and SaaS platforms to ingest documents into the CitySort pipeline.",
          },
          review: {
            title: "Document Review",
            subtitle: "Review, approve, and route documents across department queues.",
          },
          rules: {
            title: "Routing Rules",
            subtitle: "Manage classification policy, required fields, and department routing behavior for new intake.",
          },
        };

        const searchParams = new URLSearchParams(window.location.search);
        let requestedPage = (searchParams.get("page") || "overview").trim().toLowerCase();
        if (requestedPage === "db-import") {
          requestedPage = "connectors";
          searchParams.set("page", "connectors");
          window.history.replaceState(null, "", `/?${searchParams.toString()}`);
        }
        if (requestedPage === "review") {
          requestedPage = "queues";
          searchParams.set("page", "queues");
          window.history.replaceState(null, "", `/?${searchParams.toString()}`);
        }
        const activePage = Object.prototype.hasOwnProperty.call(pageConfig, requestedPage) ? requestedPage : "overview";

        const titleEl = document.querySelector(".shell-topbar h1");
        const subtitleEl = document.querySelector(".shell-topbar .subtitle");
        const meta = pageConfig[activePage];
        if (titleEl && meta) titleEl.textContent = meta.title;
        if (subtitleEl && meta) subtitleEl.textContent = meta.subtitle;

        const breadcrumbEl = document.getElementById("breadcrumb-current");
        if (breadcrumbEl && meta) breadcrumbEl.textContent = meta.title;

        const effectivePage = activePage;
        document.querySelectorAll(".sidebar-link[data-page], .tab[data-page]").forEach((link) => {
          const isActive = link.dataset.page === effectivePage;
          link.classList.toggle("active", isActive);
          if (isActive) {
            link.setAttribute("aria-current", "page");
          } else {
            link.removeAttribute("aria-current");
          }
        });

        document.querySelectorAll(".panel[data-pages]").forEach((panel) => {
          const pages = (panel.dataset.pages || "").split(/\s+/).filter(Boolean);
          const isVisible = pages.includes(activePage);
          panel.classList.toggle("is-page-hidden", !isVisible);
        });
      })();
    </script>
    <div id="response-modal" class="response-modal" hidden>
      <div class="response-modal-card">
        <div class="response-modal-head">
          <h3>Respond by Email</h3>
          <button type="button" id="response-modal-close" class="secondary">Close</button>
        </div>
        <label for="response-template-select">Template</label>
        <select id="response-template-select"></select>
        <label for="response-to-email">To</label>
        <input id="response-to-email" type="email" placeholder="recipient@example.com" />
        <label for="response-subject-input">Subject</label>
        <input id="response-subject-input" type="text" placeholder="Email subject" />
        <label for="response-body-input">Message</label>
        <textarea id="response-body-input" class="response-preview" rows="10" placeholder="Select a template to load a draft message."></textarea>
        <p id="response-send-status" class="status"></p>
        <div class="actions">
          <button type="button" id="response-copy-btn" class="secondary">Copy to Clipboard</button>
          <button type="button" id="response-send-btn">Send Email</button>
          <button type="button" id="response-cancel-btn" class="secondary">Cancel</button>
        </div>
      </div>
    </div>
    <div id="toast-container" class="toast-container" aria-live="polite"></div>
    <script src="/static/app.v2.js?v=20260210e"></script>
  </body>
</html>
