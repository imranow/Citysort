# Provider selection
# CITYSORT_OCR_PROVIDER: local | azure_di
# CITYSORT_CLASSIFIER_PROVIDER: rules | openai | anthropic
CITYSORT_OCR_PROVIDER=local
CITYSORT_CLASSIFIER_PROVIDER=rules
# Runtime environment
CITYSORT_ENV=development
# Primary datastore (recommended for production: PostgreSQL URL)
# Examples:
# - sqlite:///absolute/path/to/citysort.db
# - postgresql://user:pass@host:5432/citysort
CITYSORT_DATABASE_URL=sqlite:///data/citysort.db
CITYSORT_DATABASE_CONNECT_TIMEOUT_SECONDS=8
# Optional: custom rules path (defaults to /data/document_rules.json)
CITYSORT_RULES_PATH=
# Confidence threshold (0.0-0.99). Higher = stricter auto-routing.
CITYSORT_CONFIDENCE_THRESHOLD=0.82
# Comma-separated doc types that must always go to human review.
CITYSORT_FORCE_REVIEW_DOC_TYPES=

# Azure Document Intelligence (used only when CITYSORT_OCR_PROVIDER=azure_di)
AZURE_DOCUMENT_INTELLIGENCE_ENDPOINT=
AZURE_DOCUMENT_INTELLIGENCE_API_KEY=
AZURE_DOCUMENT_INTELLIGENCE_MODEL=prebuilt-layout
AZURE_DOCUMENT_INTELLIGENCE_API_VERSION=2024-11-30

# OpenAI classification (used only when CITYSORT_CLASSIFIER_PROVIDER=openai)
OPENAI_API_KEY=
OPENAI_MODEL=gpt-4o-mini

# Anthropic classification (used only when CITYSORT_CLASSIFIER_PROVIDER=anthropic)
ANTHROPIC_API_KEY=
ANTHROPIC_MODEL=claude-3-5-sonnet-latest

# Authentication / RBAC
# Set true in production to require bearer auth or API keys on API routes.
CITYSORT_REQUIRE_AUTH=false
# Change in production.
CITYSORT_AUTH_SECRET=change-me-in-production
CITYSORT_STRICT_AUTH_SECRET=false
# Access token lifetime in minutes.
CITYSORT_ACCESS_TOKEN_TTL_MINUTES=720
# Optional separation-of-duties: require this role for approval actions.
# Allowed: viewer | operator | admin (leave empty to disable).
CITYSORT_STRICT_APPROVAL_ROLE=

# API hardening
CITYSORT_CORS_ALLOWED_ORIGINS=http://localhost:8000,http://127.0.0.1:8000
CITYSORT_CORS_ALLOW_CREDENTIALS=false
CITYSORT_TRUSTED_HOSTS=localhost,127.0.0.1
CITYSORT_ENFORCE_HTTPS=false
CITYSORT_SECURITY_HEADERS_ENABLED=true
CITYSORT_CONTENT_SECURITY_POLICY=default-src 'self'; base-uri 'self'; frame-ancestors 'none'; object-src 'none'; img-src 'self' data:; style-src 'self' 'unsafe-inline'; script-src 'self';
CITYSORT_REFERRER_POLICY=strict-origin-when-cross-origin
CITYSORT_RATE_LIMIT_ENABLED=true
CITYSORT_RATE_LIMIT_WINDOW_SECONDS=60
CITYSORT_RATE_LIMIT_DEFAULT_PER_WINDOW=120
CITYSORT_RATE_LIMIT_UPLOAD_PER_WINDOW=20
CITYSORT_RATE_LIMIT_AI_PER_WINDOW=30

# Upload protection
CITYSORT_UPLOAD_MAX_BYTES=26214400
CITYSORT_UPLOAD_ALLOWED_EXTENSIONS=pdf,txt,md,csv,json,docx,docm,png,jpg,jpeg,tif,tiff
CITYSORT_UPLOAD_ALLOWED_MIME_PREFIXES=application/,text/,image/
CITYSORT_UPLOAD_VIRUS_SCAN_ENABLED=false
CITYSORT_UPLOAD_VIRUS_SCAN_BLOCK_ON_ERROR=true
CITYSORT_CLAMAV_HOST=127.0.0.1
CITYSORT_CLAMAV_PORT=3310

# At-rest encryption for uploaded files (Fernet key required when enabled)
CITYSORT_ENCRYPTION_AT_REST_ENABLED=false
CITYSORT_ENCRYPTION_KEY=

# Durable worker (async processing queue)
CITYSORT_WORKER_ENABLED=true
CITYSORT_WORKER_POLL_INTERVAL_SECONDS=2
CITYSORT_WORKER_MAX_ATTEMPTS=3
CITYSORT_QUEUE_BACKEND=sqlite
CITYSORT_REDIS_URL=redis://127.0.0.1:6379/0
CITYSORT_REDIS_JOB_QUEUE_NAME=citysort:jobs

# Data retention (days)
CITYSORT_AUDIT_RETENTION_DAYS=2555
CITYSORT_NOTIFICATION_RETENTION_DAYS=730
CITYSORT_OUTBOUND_EMAIL_RETENTION_DAYS=2555

# Observability
CITYSORT_LOG_LEVEL=INFO
CITYSORT_LOG_JSON=true
CITYSORT_PROMETHEUS_ENABLED=true
CITYSORT_SENTRY_DSN=
CITYSORT_SENTRY_TRACES_SAMPLE_RATE=0.0

# Outbound response email (SMTP)
CITYSORT_EMAIL_ENABLED=false
CITYSORT_EMAIL_FROM_ADDRESS=
CITYSORT_EMAIL_FROM_NAME=City Records Office
CITYSORT_SMTP_HOST=
CITYSORT_SMTP_PORT=587
CITYSORT_SMTP_USERNAME=
CITYSORT_SMTP_PASSWORD=
CITYSORT_SMTP_USE_TLS=true
CITYSORT_SMTP_USE_SSL=false
CITYSORT_SMTP_TIMEOUT_SECONDS=20

# Automation toggles
CITYSORT_AUTO_ACK_EMAIL=true
CITYSORT_AUTO_STATUS_EMAIL=true
CITYSORT_AUTO_MISSING_INFO_EMAIL=true
CITYSORT_AUTO_ASSIGN=false
CITYSORT_ESCALATION_ENABLED=true
CITYSORT_ESCALATION_DAYS=3
CITYSORT_ESCALATION_FALLBACK_USER=

# Webhooks (fire-and-forget POST on events)
CITYSORT_WEBHOOK_ENABLED=false
CITYSORT_WEBHOOK_URL=

# Watched folder ingestion
CITYSORT_WATCH_ENABLED=false
CITYSORT_WATCH_DIR=
CITYSORT_WATCH_INTERVAL_SECONDS=30

# Deployment integration
# CITYSORT_DEPLOY_PROVIDER: local | render | github
CITYSORT_DEPLOY_PROVIDER=local
# Local deploy command (optional). Supports {environment}, {actor}, {notes}.
CITYSORT_DEPLOY_COMMAND=
CITYSORT_DEPLOY_COMMAND_TIMEOUT_SECONDS=300

# Render deploy integration
CITYSORT_RENDER_DEPLOY_HOOK_URL=
CITYSORT_RENDER_API_TOKEN=
CITYSORT_RENDER_SERVICE_ID=

# GitHub Actions deploy integration
CITYSORT_GITHUB_TOKEN=
CITYSORT_GITHUB_OWNER=
CITYSORT_GITHUB_REPO=
CITYSORT_GITHUB_WORKFLOW_ID=
CITYSORT_GITHUB_REF=main
